.PHONY: db

## Generate a new migration named using the MIGRATION_NAME env var.
db/migration:
	migrate create -ext sql -dir internal/outbound/sqlite/migrations $(MIGRATION_NAME)

## Create a new database file, overwriting any existing database.
db/new:
	echo -n "" > ${REALWORLD_HOST_DATA_DIR}/${REALWORLD_DB_BASENAME}

## Open the database in the the SQLite CLI.
db/inspect:
	docker run \
	--interactive \
	--tty \
	--rm \
	--workdir ${REALWORLD_DATA_DIR} \
	--mount type=bind,src=${REALWORLD_HOST_DATA_DIR},dst=${REALWORLD_DATA_MOUNT} \
	--user ${REALWORLD_USER}:${REALWORLD_USER} \
	keinos/sqlite3 \
	sqlite3 ${REALWORLD_DB_BASENAME}
